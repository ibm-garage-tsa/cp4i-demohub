{"componentChunkName":"component---src-pages-apic-dev-jam-lab-5-index-md","path":"/APICDevJam/Lab5/","result":{"pageContext":{"frontmatter":{"title":"APIC Dev Jam Lab 5 - Advanced API Assembly"},"relativePagePath":"/APICDevJam/Lab5/index.md","titleType":"page","MdxNode":{"id":"43d13bf7-492f-5f5d-9b36-ece3dbf15a17","children":[],"parent":"5fbb19fe-6e1f-59d6-8060-525ebc494fb3","internal":{"content":"---\r\ntitle: APIC Dev Jam Lab 5 - Advanced API Assembly\r\n---\r\n\r\nIn the previous labs, you have been working with an API that acts as a\r\npass-through to a microservice application.\r\n\r\nIn this lab, you will expand the product offerings for ThinkIBM. In\r\naddition to the Inventory API, ThinkIBM wishes to provide APIs that\r\noffer financing and shipping logistics to consumer applications. Your\r\ngoal is to utilize existing enterprise and public assets to create these\r\nAPI offerings.\r\n\r\nIn this tutorial, you will explore the following key capabilities:\r\n\r\n-   Create a new API, including object definitions and paths.\r\n\r\n-   Configure an API to access an existing SOAP service.\r\n\r\n-   Import an existing API from an OpenAPI definition document (a.k.a\r\n    Swagger).\r\n\r\n-   Map data retrieved from multiple API calls into an aggregate\r\n    response.\r\n\r\n-   Use GatewayScript directly within an API assembly.\r\n\r\n## APIC Dev Jam Series\r\n\r\nThe APIC Dev Jam Series is a hands-on workshop with lab exercises that\r\nwalk you through designing, publishing, and securing APIs. This workshop\r\nis for API developers, architects, and line of business people who want\r\nto create a successful API strategy. There are 8 labs and each is 30\r\nminutes long. Make sure you choose enough time in your reservation to\r\nget through all the labs! \r\n\r\n[NOTE: ]**[This demo environment contains a\r\nfull API Connect installation in Cloud Pak for Integration. The login\r\ninformation to the APIC cluster will be sent in a separate email when\r\nyou reserve the instance. Use Google Chrome, Firefox or Microsoft Edge\r\nto access the cluster using the credentials supplied. Make sure you\r\nlogin using API Manager User Registry not Common Services\r\nregistry.]**\r\n\r\nPrerequisites: Labs 1-4\r\n\r\n## Create and Define the Financing API (REST to SOAP)\r\n\r\nThinkIBM wants to give its customers the ability to calculate financing\r\npayments. There is already a legacy SOAP-based application which will do\r\nthe calculation, but it should be exposed to consumers as a modern\r\nRESTful API. In this section, you will create a new OpenAPI definition\r\nfor the financing API.\r\n\r\n1. From the left navigation menu,\r\n  click **[Develop.]**\r\n\r\n2. Click **[Add]** and\r\n  choose **[API]**.\r\n\r\n    ![](images/tutorial_html_35bc8347ebf9f3c4.png)\r\n\r\n3. Select **[New OpenAPI]** and click [[Next.]]\r\n\r\n    ![](images/tutorial_html_8027761d9675e244.png)\r\n\r\n4. Fill in the form for **Create New OpenAPI** with the following values: \r\n\r\n    **[Title: financing]**\r\n\r\n    **Name: financing**\r\n\r\n    **Base Path: /financing**\r\n\r\n    **Version: 1.0.0**\r\n\r\n    Click **Next**.\r\n\r\n    ![](images/tutorial_html_6dab5b579d7af76.png)\r\n\r\n5. Leave all default values and click [[Next. ]]API\r\n    Connect will generate a new OpenAPI definition for the financing API and\r\n    provide a summary with the performed activities.\r\n\r\n    ![](images/tutorial_html_fb454c7ee948008d.png)\r\n\r\n6.  Click  **[Edit API ]**to customize the API.**\r\n\r\n7. Create the model definition for the new API. These definitions are\r\n    used in a few places. Their primary role is to serve as documentation in\r\n    the developer portal on expected input and output parameters. However,\r\n    they can also be used for data mapping actions.\r\n    Click **[Definitions]** from the API\r\n    Designer menu on the left. Then,\r\n    click **[Add]** to create a new definition.\r\n\r\n    ![](images/tutorial_html_f584c2696c3ce084.png)\r\n\r\n8. Enter **[paymentAmount]** for **[Name]** and\r\n    leave the definition **[Type]** set\r\n    to **[object]**.\r\n\r\n9. Click **[Add]** in\r\n    the **[Properties]** section.\r\n\r\n    ![](images/tutorial_html_332203efe7e366f5.png)\r\n\r\n10. Edit the **property values** using the following values:\r\n\r\n    **Property Name: paymentAmount**\r\n\r\n    **Type: float**\r\n\r\n    **Example: 199.99**\r\n\r\n    **Description: Monthly payment amount**\r\n\r\n    The page will look like this:\r\n\r\n   ![](images/tutorial_html_c600b4bb8ec6adee.png)\r\n\r\n    The property will be utilized in the Path you create next.\r\n    Click **[Save]** to go back to the main API\r\n    Editor.\r\n\r\n11. Click [[Paths]] in\r\n    the navigation menu on the left. Then\r\n    click **[Add]** to create a new path.\r\n\r\n    ![](images/tutorial_html_f3f04d5e1fde784d.png)\r\n\r\n12. The Path screen is loaded. Edit the [[Path name]] to be **[/calculate]**. **[Note:]** [Recall that our Base\r\n    Path for this API is \\`financing\\`. This new path will be appended to\r\n    the base, creating a final path of       \r\n    /financing/calculate.]**\r\n\r\n13. Click [[Add]] in\r\n    the Operations section to define the operation to support under the\r\n    path.\r\n\r\n    ![](images/tutorial_html_32f5ad5e80b58cd5.png)\r\n\r\n14. From the **[Add Operation]** menu,\r\n    select the **[Get]** operation and then\r\n    click **[Add]**. \r\n\r\n    ![](images/tutorial_html_aae3e2ff9be52791.png)\r\n\r\n15. Click **[Save]**. You will be\r\n    redirected to the main API Editor to continue.\r\n\r\n    ![](images/tutorial_html_66cc80ef2c7d855b.png)\r\n\r\n16. Click the **[/calculate]** path we just created.\r\n\r\n    ![](images/tutorial_html_864cc1225031590a.png)\r\n\r\n17. Click the **[GET]** operation to add\r\n    the request parameters. This defines the input to the API request. Since\r\n    this is a GET request, you will add the required request parameters to\r\n    the query component of the URI.\r\n\r\n    ![](images/tutorial_html_2cf0c1234fbd4aa3.png)\r\n\r\n18. Scroll down to the Parameters section within the operation config.\r\n    Click [[Add]] in the [[Parameters]] section.\r\n    You are actually going to need three total parameters for this\r\n    operation, so go ahead and click the \\`**Add**\\` button **two more\r\n    times** to add the parameter templates.\r\n\r\n    ![](images/tutorial_html_1e46988677afe0a.png)\r\n\r\n19. Edit the **parameters** to set the values:\r\n\r\n```\r\n  **Required**   **Name**   **Located In**   **Type**   **Description**\r\n  -------------- ---------- ---------------- ---------- --------------------------\r\n  yes            amount     Query            float      amount to finance\r\n  yes            duration   Query            int 32     length of term in months\r\n  yes            rate       Query            float      interest rate\r\n\r\n```\r\n  Once you have entered the values, the screen will look like this:\r\n\r\n  ![](images/tutorial_html_2fc0008e5f75928e.png)\r\n\r\n20. Set the schema for the response. Click **Add** in\r\n    the **[Response]** section.\r\n    Enter [[200]] for [[STATUS CODE]].\r\n    Since we already defined\r\n    the **[paymentAmount]** definition, select\r\n    it from the drop down list\r\n    for [[SCHEMA]].\r\n    You will find\r\n    the **[paymentAmount]** definition at the\r\n    bottom of the list.\r\n    For [[DESCRIPTION]] enter [[amount\r\n    calculated\r\n    successfully]]\r\n    ![](images/tutorial_html_f51180a01dc389af.png)\r\n\r\n21. Click [[Save]] to\r\n    save the API definition.\r\n\r\n    ![](images/tutorial_html_a0106fbcef024d0.png)\r\n\r\n## Map the API to a Service WSDL\r\n\r\nImport the legacy Financing SOAP service WSDL and map it to the RESTful\r\nAPI definition.\r\n\r\n### Attach a Service WSDL\r\n\r\n1.  Click the **[Target Services]** option\r\n    in the left column menu palette from the **[financing\r\n    1.0.0]** API Design screen\r\n\r\n2.  Click **[Add]** to import the web\r\n    service from the legacy financing service.\r\n\r\n    ![](images/tutorial_html_ebb6419fc4fb979a.png)\r\n\r\n3.  Download the [calculate.wsdl](https://integrationsuperhero.github.io/techcon2020/APICDevJam/resources/calculate.wsdl) and then Click **[Browse]** to\r\n    select [[calculate.wsdl]] located\r\n    in where you downloaded it on your machine.\r\n\r\n    ![](images/tutorial_html_e10ec45733dfce99.png)\r\n\r\n    You will get a success message and the service included in the WSDL\r\n    will be displayed.\r\n\r\n    ![](images/tutorial_html_6a8444e050b87ad3.png)\r\n\r\n5. Select **[financingService.]** Then click **[Submit]**.\r\n\r\n   ### Build the Financing API Assembly\r\n\r\n1. Click [[Assemble]] to\r\n    access the assembly editor.\r\n\r\n    ![](images/tutorial_html_7ecdd003a7db2e23.png)\r\n\r\n2. In the processing pipeline, mouse over\r\n    the [[invoke]] policy\r\n    and click\r\n    the [[trashcan]] icon\r\n    to delete it.\r\n\r\n    ![](images/tutorial_html_d05e099dd7e132b4.png)\r\n\r\n3. Scroll down to the bottom of the policy menu and drag and drop\r\n    the **[financing web service\r\n    operations]** to processing pipeline.\r\n\r\n    ![](images/tutorial_html_771de22ad92a31fb.png)\r\n\r\n4. Now you are going to modify the input and output map policy for\r\n    mapping your REST API into SOAP.\r\n\r\n    ![](images/tutorial_html_4a933c8c317bbd97.png)\r\n\r\n5. Since we are using the new API Gateway, we will need to instruct it\r\n    to use the newer version of the policies in the flow (map, invoke, map).\r\n    Click Source to go to the OpenAPI definition of your API.\r\n\r\n    ![](images/tutorial_html_35460e46cf085196.png)\r\n\r\n6. Scroll down to map and insert [[version: 2.0.0]] right\r\n    below it. \r\n\r\n    ![](images/tutorial_html_66473f670a224c38.png)\r\n\r\n7. Scroll down to invoke and insert [[version 2.0.0]] right\r\n    below it. Skip if the version 2.0.0 is already populated.\r\n\r\n    ![](images/tutorial_html_d480dfb5896607c6.png)\r\n\r\n8. Now go to the last map and insert **[version: 2.0.0]** right below it.\r\n    Click [[Assemble]] to\r\n    go back to the gateway flow designer. Skip if the version 2.0.0 is already populated.\r\n\r\n    ![](images/tutorial_html_80b968197ef6f435.png)\r\n\r\n9. In order to consume a SOAP-based service from your REST-based API,\r\n    you need to map the query parameter inputs that were previously defined\r\n    as part of the GET /calculate operation to a SOAP payload. To do so,\r\n    click the [[financing\r\n    input]] map\r\n    policy on our pipeline to open the map editor.\r\n\r\n    [[Tip: Click on the \\`+\\` icon to make the editor window fill the\r\n    screen.]]\r\n\r\n10. Click on\r\n    the [[pencil icon]] in\r\n    the [[Input column]].\r\n\r\n    ![](images/tutorial_html_9d82765fc8e50237.png)\r\n\r\n11. Click [[+ parameters for operation\\...]] and\r\n    select the **[GET Calculate operation]**.\r\n\r\n    ![](images/tutorial_html_9dad0a59d5e53a96.png)\r\n\r\n    The Map editor will automatically pull in the request parameters\r\n    that you defined earlier.\r\n\r\n12. Click **[Done]** to return to the map\r\n    editor.\r\n\r\n13. For each of the Input query parameters, map them to their\r\n    respective SOAP Output elements.\r\n\r\n    To map from an input field to an output field, click the circle next\r\n    to the source element once, then click the circle next to the target\r\n    element. A line will be drawn between the two, indicating a mapping from\r\n    the source to the target.\r\n\r\n![](images/tutorial_html_e18d417ab873efe0.png)\r\n    \r\n14. Click [[\\`X\\`]] in\r\n    the map editor to return to the policy pipeline.\r\n\r\n15. Click\r\n    the [[invoke policy]] to\r\n    open its editor.\r\n\r\n16. The SOAP service URL has already been set for you during the\r\n    service import when we create the API.\r\n\r\n    ![](images/tutorial_html_8d30f4d88ab4c2bf.png)\r\n\r\n17. Click [[\\`X\\`]] to\r\n    return to the policy pipeline.\r\n\r\n18. After the Financing Web Service is invoked, you need to map the\r\n    SOAP response into a JSON object.\r\n\r\n    You already defined the response object\r\n    called [[paymentAmount]].\r\n    To do the map, click the **[financing\r\n    output]** map policy on the pipeline to\r\n    open the map editor.\r\n\r\n19. Click the [[pencil icon]] to set the output object schema.\r\n\r\n20. Click the **[+ outputs for\r\n    operation\\...]** option and select\r\n    the [[GET /calculate operation]].\r\n\r\n21. Set the [[Content type]] configuration\r\n    option\r\n    to [[application/json]],\r\n    and then\r\n    click [[Done]] to\r\n    return to the map editor.\r\n\r\n    ![](images/tutorial_html_4e9aa0f663bd6c06.png)\r\n\r\n22. Click the [[circle next to the paymentAmount source\r\n    element]] once,\r\n    then click the [[circle next to the target\r\n    element]].\r\n    A line will be drawn between the two, indicating a mapping from the\r\n    source to the target.\r\n\r\n    ![](images/tutorial_html_f2e452da44248e01.png)\r\n\r\n23. Click [[\\`X\\`]] in\r\n    the map editor to return to the policy pipeline.\r\n\r\n24. Click [[Save]] the API definition.\r\n\r\n25. Click **[Develop]** in the navigation\r\n    menu to return to the list of APIs and Products in your system.\r\n\r\n    ![](images/tutorial_html_a810481f55373ff0.png)\r\n\r\n## Import Logistics API\r\n\r\nIn this lab section, we will be adding a new API called logistics which\r\nwill provide helper services around calculating shipping rates and\r\nlocating nearby stores. Rather than require you to build the entire API\r\nfrom scratch again, you will see how you can import and modify an\r\nexisting OpenAPI definition.\r\n\r\n### Import the OpenAPI Definition\r\n\r\n1.  Click **[Add]** and\r\n    select **[API.]**  \r\n\r\n    ![](images/tutorial_html_44524c2a518bf56e.png)\r\n\r\n2.  From the Create API wizard, select [[Import: Existing\r\n    OpenAPI]].\r\n    Then\r\n    click [[Next]].  ![](images/tutorial_html_5515164592670a5f.png)\r\n\r\n3.  You will need logistics.yaml file for this step. Fron another browser window download the file using this link\r\n    [logistics.yaml](https://integrationsuperhero.github.io/techcon2020/APICDevJam/resources/logistics.yaml)\r\n\r\n    Click \\`**Browse**\\` in the [[Import from\r\n    file]] window, and select the downloaded logistics.yaml file.\r\n\r\n    ![](images/tutorial_html_2ec43e484c5482b0.png)\r\n\r\n4.  Click [[Next]] in\r\n    the confirmation window.\r\n\r\n5.  Click [[Next]] one\r\n    more time [[without selecting the option Activate\r\n    API]] since\r\n    we still need to make some updates.\r\n\r\n6.  Click [[Edit\r\n    API]] in\r\n    the [[Summary]] page\r\n    to go to the API editor.\r\n\r\n### Configure payload to be stored in Analytics\r\n\r\n1.  From the API menu, select [[Activity\r\n    Log]].\r\n    In\r\n    the [[Content]] drop-down,\r\n    select [[payload]].\r\n    A pop up window will be displayed, asking to enable buffering.\r\n    Click [[Continue]].\r\n\r\n    ![](images/tutorial_html_e8ffcd636704e49b.png)\r\n\r\n2.  Set the [[Content on\r\n    error]] drop-down\r\n    to [[activity]].\r\n    Click [[Save]].\r\n\r\n    ![](images/tutorial_html_1b4e90745e45c224.png)\r\n\r\n## Create an Orchestration Assembly\r\n\r\nThe logistics API provides resources for calculating shipping costs and\r\nlocating the nearest store for pickup. In this section, you will\r\nconfigure the assembly for the shipping calculation resource. Your API\r\nassembly will call out to two separate shipping vendors and provide a\r\nconsolidated response back to the consumer.\r\n\r\n### Create the Logistics API Assembly\r\n\r\n1.  Switch to\r\n    the [[Assemble]] tab\r\n    and remove\r\n    the [[invoke]] policy\r\n    by hovering over it and selecting the [[trashcan\r\n    icon]].\r\n\r\n2.  Click and drag\r\n    the [[Operation switch]] policy\r\n    to flow pipeline in the right.\r\n\r\n3.  The switch editor will open with a single case with case 0 created\r\n    by default.\r\n\r\n4.  Next to case 0, click **[search\r\n    operations\\...]** to show the drop-down\r\n    list of available operations.\r\n\r\n5.  Select\r\n    the **[shipping.calc]** operation.\r\n\r\n6.  Click the **[+ Case]** button to add a\r\n    second case for\r\n    the [[get.stores]] operation.\r\n\r\n7.  Click **[X]** to close the operation\r\n    switch configuration editor and then\r\n    click [[Save]].\r\n    You should see two new processing pipelines created on your\r\n    \\`operation-switch\\` step - one for each case:\r\n\r\n    ![](images/tutorial_html_2805ad613d2ba436.png)\r\n\r\n \r\n\r\n### Configure the `shipping.calc` Case\r\n\r\nThis operation will end up invoking two separate back-end services to\r\nacquire shipping rates for the respective companies, then utilize a map\r\naction to combine the two separate responses back into a single,\r\nconsolidated message for our consumers.\r\n\r\n1.  Add an [[invoke\r\n    policy]] to\r\n    the [[shipping.calc case]].\r\n\r\n2.  Edit the **[invoke]** action with the\r\n    following properties:\r\n\r\n    -   [[Title:\r\n        invoke_xyz]]\r\n\r\n    -   [[URL: $(shipping_svc_url)?company=xyz&from_zip=90210&to_zip=\\{zip\\}]]\r\n\r\n    -   [[Stop on error: unchecked]]\r\n\r\n    -   [[Response object variable (scroll to the bottom):\r\n        xyz_response]]  ![](images/tutorial_html_8c4d5816115227c1.png)  \r\n         ![](images/tutorial_html_3a71962c80162408.png)\r\n\r\n    -   **[Note: The  parameter provided here is a reference to the\r\n        zip parameter defined as input to the operation. The\r\n        portion of the URL will get replaced by the actual zip code\r\n        provided by the API consumers. ]**\r\n\r\n3.  Hover over\r\n    the [[invoke\\_xyz policy]] and\r\n    click [[clone]] to\r\n    add another invoke action:  \r\n\r\n    ![](images/tutorial_html_c099b7fb4e29d1ef.png)  \r\n\r\n4.  Edit the new invoke policy with the following properties:\r\n\r\n    -   [[Title:\r\n        invoke\\_cek]]\r\n\r\n    -   [[URL:\r\n        \\$(shipping\\_svc\\_url)?company=cek&from\\_zip=90210&to\\_zip= ]]\r\n\r\n    -   [[Response object variable:\r\n        cek\\_response]]  \r\n\r\n        ![](images/tutorial_html_84608c0a3a93f935.png)\r\n\r\n        ![](images/tutorial_html_e4fed02337332021.png)\r\n\r\n5.  Add\r\n    a [[map policy]] after\r\n    the last invoke and then click it to open the\r\n    editor.  ![](images/tutorial_html_df80d082c629e3eb.png)  \r\n\r\n6.  Click\r\n    the [[pencil]] at\r\n    the top of the Input column, then click on the [[+\r\n    input]] button.\r\n    Enter the following input configuration:\r\n\r\n    -   [[Context variable:\r\n        xyz\\_response.body]]\r\n\r\n    -   [[Name:\r\n        xyz]]\r\n\r\n    -   [[Content type:\r\n        application/json]]\r\n\r\n    -   [[Definition:\r\n        #/definitions/xyz_shipping_rsp]]\r\n\r\n7.  Click the [[+\r\n    input]] button\r\n    again to add another input. Specify the following input\r\n    configuration:\r\n\r\n    -   [[Context variable:\r\n        cek_response.body]]\r\n\r\n    -   [[Name:cek]]\r\n\r\n    -   [[Content type:\r\n        application/json]]\r\n\r\n    -   [[Definition:\r\n        #/definitions/cek_shipping_rsp]]\r\n\r\n8.  You now have two inputs assigned to the\r\n    map policy:  ![](images/tutorial_html_1cecd20554b4f15b.png)\r\n\r\n9.  Click [[Done]] to\r\n    return to the editor.\r\n\r\n10. Click the [[pencil\r\n    icon]] at\r\n    the top of\r\n    the [[Output]] column\r\n    and then click [[+ outputs for\r\n    operation\\...]] and\r\n    choose\r\n    the [[shipping.calc]] operation.\r\n\r\n11. Set **[Content\r\n    type]** to [[application/json]].\r\n\r\n12. Click [[Done]] to\r\n    return to the editor.\r\n\r\n13. Complete the mapping. To map from an input field to an output field,\r\n    click the circle next to the source element once, then click the\r\n    circle next to the target element. A line will be drawn between the\r\n    two, indicating a mapping from the source to the\r\n    target. ![](images/tutorial_html_c7529b39125204de.png)\r\n\r\n14. Click **X** to close the map editor. Your assembly policy for the\r\n    shipping.calc operation is now complete.\r\n\r\n    ![](images/tutorial_html_60e39f1d04c62b0b.png)\r\n\r\n15. Save your changes.\r\n\r\n    ![](images/tutorial_html_8eaea845d79feb97.png)\r\n\r\n## Use GatewayScript in an Assembly\r\n\r\nIn this section, you will configure the assembly for the store locator\r\nresource. You will use GatewayScript to modify the response to your\r\nconsumers, providing them a maps link to the nearest store location.\r\n\r\n### Configure the `get.stores` Case\r\n\r\nThis operation will call out to the Google Geocode API to obtain\r\nlocation information about the provided zip code, and will then utilize\r\na simple gatewayscript to modify the response and provide a formatted\r\nGoogle Maps link.\r\n\r\n1.  Add an invoke policy to\r\n    the [[get.stores case]].  ![](images/tutorial_html_8fcccda10f7fbc1e.png)\r\n\r\n2.  Edit the\r\n    new [[invoke action]] with\r\n    the following properties:\r\n\r\n    -   [[Title:\r\n        invoke\\_google\\_geolocate  ]]\r\n\r\n    -   [[URL:\r\n        https://maps.googleapis.com/maps/api/geocode/json?&address=]]\r\n\r\n    -   [[Stop on error:\r\n        unchecked ]]\r\n\r\n    -   [[Response object variable (scroll to the bottom):\r\n        google\\_geocode\\_response]]  ![](images/tutorial_html_c230669eaa51ffee.png)  \r\n          ![](images/tutorial_html_bcc946b43e8188.png)\r\n\r\n3.  Click [[X]] to\r\n    close the invoke editor.\r\n\r\n4.  Add\r\n    a [[gatewayscript policy]] with\r\n    the following properties:\r\n\r\n    -   **[Title:\r\n        gws\\_format\\_maps\\_link]**\r\n\r\n    -   Copy the following GatewayScript snippet and paste it into the\r\n        text area:\r\n\r\n```\r\n// Save the Google Geocode response body to variable\r\nvar mapsApiRsp = apim.getvariable('google_geocode_response.body');\r\n\r\n// Get location attributes from geocode response body\r\nvar location = mapsApiRsp.results[0].geometry.location;\r\n\r\n// Set up the response data object, concat the latitude and longitude\r\nvar rspObj = {\"google_maps_link\": \"https://www.google.com/maps?q=\" + location.lat + \",\" + location.lng};\r\n\r\n// Save the output     \r\napim.setvariable('message.body', rspObj)\r\n\r\n```\r\n\r\n  ![](images/tutorial_html_d005e2f600ea91f1.png)\r\n\r\n-   **[Note: Take a quick look at line 5. Notice how our gateway script\r\n    file is reading the body portion of the google\\_geocode\\_response\r\n    variable which was assigned to the output of the invoke\r\n    action.]**\r\n\r\n    Click [[X]] to\r\n    close the gatewayscript editor.\r\n\r\n    Your assembly for the \\`logistics\\` API will now include two separate\r\n    operation policies:  \r\n\r\n    ![](images/tutorial_html_3e32e5d9e2c3d543.png)\r\n\r\n7.  **Save** your\r\n    changes.  ![](images/tutorial_html_8eaea845d79feb97.png)\r\n\r\n8.  Click [[Develop]] in\r\n    the navigation menu to return to the list of APIs and Products in\r\n    your system.\r\n\r\n    ![](images/tutorial_html_a810481f55373ff0.png)\r\n\r\n## Summary\r\n\r\nCongratulations! You have successfully configured two new API's with\r\nadvanced assemblies. Throughout the tutorial, you explored the key\r\ntakeaways:\r\n\r\n-   Create a new API, including object definitions and paths.\r\n\r\n-   Configure an API to access an existing SOAP service.\r\n\r\n-   Import an existing API from an OpenAPI definition document (a.k.a\r\n    Swagger).\r\n\r\n-   Map data retrieved from multiple API calls into an aggregate\r\n    response.\r\n\r\n-   Use GatewayScript directly within an API assembly.\r\n\r\nContinue with the APIC Dev Jam! Go\r\nto [APIC Dev Jam - Lab 6 - Working with API Products](../Lab6))] to\r\nlearn about bundling the API's into a Product and publishing it to the consumer portal.\r\n","type":"Mdx","contentDigest":"18a86fca1c2a8ae980eb6a114721d15a","counter":1560,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"APIC Dev Jam Lab 5 - Advanced API Assembly"},"exports":{},"rawBody":"---\r\ntitle: APIC Dev Jam Lab 5 - Advanced API Assembly\r\n---\r\n\r\nIn the previous labs, you have been working with an API that acts as a\r\npass-through to a microservice application.\r\n\r\nIn this lab, you will expand the product offerings for ThinkIBM. In\r\naddition to the Inventory API, ThinkIBM wishes to provide APIs that\r\noffer financing and shipping logistics to consumer applications. Your\r\ngoal is to utilize existing enterprise and public assets to create these\r\nAPI offerings.\r\n\r\nIn this tutorial, you will explore the following key capabilities:\r\n\r\n-   Create a new API, including object definitions and paths.\r\n\r\n-   Configure an API to access an existing SOAP service.\r\n\r\n-   Import an existing API from an OpenAPI definition document (a.k.a\r\n    Swagger).\r\n\r\n-   Map data retrieved from multiple API calls into an aggregate\r\n    response.\r\n\r\n-   Use GatewayScript directly within an API assembly.\r\n\r\n## APIC Dev Jam Series\r\n\r\nThe APIC Dev Jam Series is a hands-on workshop with lab exercises that\r\nwalk you through designing, publishing, and securing APIs. This workshop\r\nis for API developers, architects, and line of business people who want\r\nto create a successful API strategy. There are 8 labs and each is 30\r\nminutes long. Make sure you choose enough time in your reservation to\r\nget through all the labs! \r\n\r\n[NOTE: ]**[This demo environment contains a\r\nfull API Connect installation in Cloud Pak for Integration. The login\r\ninformation to the APIC cluster will be sent in a separate email when\r\nyou reserve the instance. Use Google Chrome, Firefox or Microsoft Edge\r\nto access the cluster using the credentials supplied. Make sure you\r\nlogin using API Manager User Registry not Common Services\r\nregistry.]**\r\n\r\nPrerequisites: Labs 1-4\r\n\r\n## Create and Define the Financing API (REST to SOAP)\r\n\r\nThinkIBM wants to give its customers the ability to calculate financing\r\npayments. There is already a legacy SOAP-based application which will do\r\nthe calculation, but it should be exposed to consumers as a modern\r\nRESTful API. In this section, you will create a new OpenAPI definition\r\nfor the financing API.\r\n\r\n1. From the left navigation menu,\r\n  click **[Develop.]**\r\n\r\n2. Click **[Add]** and\r\n  choose **[API]**.\r\n\r\n    ![](images/tutorial_html_35bc8347ebf9f3c4.png)\r\n\r\n3. Select **[New OpenAPI]** and click [[Next.]]\r\n\r\n    ![](images/tutorial_html_8027761d9675e244.png)\r\n\r\n4. Fill in the form for **Create New OpenAPI** with the following values: \r\n\r\n    **[Title: financing]**\r\n\r\n    **Name: financing**\r\n\r\n    **Base Path: /financing**\r\n\r\n    **Version: 1.0.0**\r\n\r\n    Click **Next**.\r\n\r\n    ![](images/tutorial_html_6dab5b579d7af76.png)\r\n\r\n5. Leave all default values and click [[Next. ]]API\r\n    Connect will generate a new OpenAPI definition for the financing API and\r\n    provide a summary with the performed activities.\r\n\r\n    ![](images/tutorial_html_fb454c7ee948008d.png)\r\n\r\n6.  Click  **[Edit API ]**to customize the API.**\r\n\r\n7. Create the model definition for the new API. These definitions are\r\n    used in a few places. Their primary role is to serve as documentation in\r\n    the developer portal on expected input and output parameters. However,\r\n    they can also be used for data mapping actions.\r\n    Click **[Definitions]** from the API\r\n    Designer menu on the left. Then,\r\n    click **[Add]** to create a new definition.\r\n\r\n    ![](images/tutorial_html_f584c2696c3ce084.png)\r\n\r\n8. Enter **[paymentAmount]** for **[Name]** and\r\n    leave the definition **[Type]** set\r\n    to **[object]**.\r\n\r\n9. Click **[Add]** in\r\n    the **[Properties]** section.\r\n\r\n    ![](images/tutorial_html_332203efe7e366f5.png)\r\n\r\n10. Edit the **property values** using the following values:\r\n\r\n    **Property Name: paymentAmount**\r\n\r\n    **Type: float**\r\n\r\n    **Example: 199.99**\r\n\r\n    **Description: Monthly payment amount**\r\n\r\n    The page will look like this:\r\n\r\n   ![](images/tutorial_html_c600b4bb8ec6adee.png)\r\n\r\n    The property will be utilized in the Path you create next.\r\n    Click **[Save]** to go back to the main API\r\n    Editor.\r\n\r\n11. Click [[Paths]] in\r\n    the navigation menu on the left. Then\r\n    click **[Add]** to create a new path.\r\n\r\n    ![](images/tutorial_html_f3f04d5e1fde784d.png)\r\n\r\n12. The Path screen is loaded. Edit the [[Path name]] to be **[/calculate]**. **[Note:]** [Recall that our Base\r\n    Path for this API is \\`financing\\`. This new path will be appended to\r\n    the base, creating a final path of       \r\n    /financing/calculate.]**\r\n\r\n13. Click [[Add]] in\r\n    the Operations section to define the operation to support under the\r\n    path.\r\n\r\n    ![](images/tutorial_html_32f5ad5e80b58cd5.png)\r\n\r\n14. From the **[Add Operation]** menu,\r\n    select the **[Get]** operation and then\r\n    click **[Add]**. \r\n\r\n    ![](images/tutorial_html_aae3e2ff9be52791.png)\r\n\r\n15. Click **[Save]**. You will be\r\n    redirected to the main API Editor to continue.\r\n\r\n    ![](images/tutorial_html_66cc80ef2c7d855b.png)\r\n\r\n16. Click the **[/calculate]** path we just created.\r\n\r\n    ![](images/tutorial_html_864cc1225031590a.png)\r\n\r\n17. Click the **[GET]** operation to add\r\n    the request parameters. This defines the input to the API request. Since\r\n    this is a GET request, you will add the required request parameters to\r\n    the query component of the URI.\r\n\r\n    ![](images/tutorial_html_2cf0c1234fbd4aa3.png)\r\n\r\n18. Scroll down to the Parameters section within the operation config.\r\n    Click [[Add]] in the [[Parameters]] section.\r\n    You are actually going to need three total parameters for this\r\n    operation, so go ahead and click the \\`**Add**\\` button **two more\r\n    times** to add the parameter templates.\r\n\r\n    ![](images/tutorial_html_1e46988677afe0a.png)\r\n\r\n19. Edit the **parameters** to set the values:\r\n\r\n```\r\n  **Required**   **Name**   **Located In**   **Type**   **Description**\r\n  -------------- ---------- ---------------- ---------- --------------------------\r\n  yes            amount     Query            float      amount to finance\r\n  yes            duration   Query            int 32     length of term in months\r\n  yes            rate       Query            float      interest rate\r\n\r\n```\r\n  Once you have entered the values, the screen will look like this:\r\n\r\n  ![](images/tutorial_html_2fc0008e5f75928e.png)\r\n\r\n20. Set the schema for the response. Click **Add** in\r\n    the **[Response]** section.\r\n    Enter [[200]] for [[STATUS CODE]].\r\n    Since we already defined\r\n    the **[paymentAmount]** definition, select\r\n    it from the drop down list\r\n    for [[SCHEMA]].\r\n    You will find\r\n    the **[paymentAmount]** definition at the\r\n    bottom of the list.\r\n    For [[DESCRIPTION]] enter [[amount\r\n    calculated\r\n    successfully]]\r\n    ![](images/tutorial_html_f51180a01dc389af.png)\r\n\r\n21. Click [[Save]] to\r\n    save the API definition.\r\n\r\n    ![](images/tutorial_html_a0106fbcef024d0.png)\r\n\r\n## Map the API to a Service WSDL\r\n\r\nImport the legacy Financing SOAP service WSDL and map it to the RESTful\r\nAPI definition.\r\n\r\n### Attach a Service WSDL\r\n\r\n1.  Click the **[Target Services]** option\r\n    in the left column menu palette from the **[financing\r\n    1.0.0]** API Design screen\r\n\r\n2.  Click **[Add]** to import the web\r\n    service from the legacy financing service.\r\n\r\n    ![](images/tutorial_html_ebb6419fc4fb979a.png)\r\n\r\n3.  Download the [calculate.wsdl](https://integrationsuperhero.github.io/techcon2020/APICDevJam/resources/calculate.wsdl) and then Click **[Browse]** to\r\n    select [[calculate.wsdl]] located\r\n    in where you downloaded it on your machine.\r\n\r\n    ![](images/tutorial_html_e10ec45733dfce99.png)\r\n\r\n    You will get a success message and the service included in the WSDL\r\n    will be displayed.\r\n\r\n    ![](images/tutorial_html_6a8444e050b87ad3.png)\r\n\r\n5. Select **[financingService.]** Then click **[Submit]**.\r\n\r\n   ### Build the Financing API Assembly\r\n\r\n1. Click [[Assemble]] to\r\n    access the assembly editor.\r\n\r\n    ![](images/tutorial_html_7ecdd003a7db2e23.png)\r\n\r\n2. In the processing pipeline, mouse over\r\n    the [[invoke]] policy\r\n    and click\r\n    the [[trashcan]] icon\r\n    to delete it.\r\n\r\n    ![](images/tutorial_html_d05e099dd7e132b4.png)\r\n\r\n3. Scroll down to the bottom of the policy menu and drag and drop\r\n    the **[financing web service\r\n    operations]** to processing pipeline.\r\n\r\n    ![](images/tutorial_html_771de22ad92a31fb.png)\r\n\r\n4. Now you are going to modify the input and output map policy for\r\n    mapping your REST API into SOAP.\r\n\r\n    ![](images/tutorial_html_4a933c8c317bbd97.png)\r\n\r\n5. Since we are using the new API Gateway, we will need to instruct it\r\n    to use the newer version of the policies in the flow (map, invoke, map).\r\n    Click Source to go to the OpenAPI definition of your API.\r\n\r\n    ![](images/tutorial_html_35460e46cf085196.png)\r\n\r\n6. Scroll down to map and insert [[version: 2.0.0]] right\r\n    below it. \r\n\r\n    ![](images/tutorial_html_66473f670a224c38.png)\r\n\r\n7. Scroll down to invoke and insert [[version 2.0.0]] right\r\n    below it. Skip if the version 2.0.0 is already populated.\r\n\r\n    ![](images/tutorial_html_d480dfb5896607c6.png)\r\n\r\n8. Now go to the last map and insert **[version: 2.0.0]** right below it.\r\n    Click [[Assemble]] to\r\n    go back to the gateway flow designer. Skip if the version 2.0.0 is already populated.\r\n\r\n    ![](images/tutorial_html_80b968197ef6f435.png)\r\n\r\n9. In order to consume a SOAP-based service from your REST-based API,\r\n    you need to map the query parameter inputs that were previously defined\r\n    as part of the GET /calculate operation to a SOAP payload. To do so,\r\n    click the [[financing\r\n    input]] map\r\n    policy on our pipeline to open the map editor.\r\n\r\n    [[Tip: Click on the \\`+\\` icon to make the editor window fill the\r\n    screen.]]\r\n\r\n10. Click on\r\n    the [[pencil icon]] in\r\n    the [[Input column]].\r\n\r\n    ![](images/tutorial_html_9d82765fc8e50237.png)\r\n\r\n11. Click [[+ parameters for operation\\...]] and\r\n    select the **[GET Calculate operation]**.\r\n\r\n    ![](images/tutorial_html_9dad0a59d5e53a96.png)\r\n\r\n    The Map editor will automatically pull in the request parameters\r\n    that you defined earlier.\r\n\r\n12. Click **[Done]** to return to the map\r\n    editor.\r\n\r\n13. For each of the Input query parameters, map them to their\r\n    respective SOAP Output elements.\r\n\r\n    To map from an input field to an output field, click the circle next\r\n    to the source element once, then click the circle next to the target\r\n    element. A line will be drawn between the two, indicating a mapping from\r\n    the source to the target.\r\n\r\n![](images/tutorial_html_e18d417ab873efe0.png)\r\n    \r\n14. Click [[\\`X\\`]] in\r\n    the map editor to return to the policy pipeline.\r\n\r\n15. Click\r\n    the [[invoke policy]] to\r\n    open its editor.\r\n\r\n16. The SOAP service URL has already been set for you during the\r\n    service import when we create the API.\r\n\r\n    ![](images/tutorial_html_8d30f4d88ab4c2bf.png)\r\n\r\n17. Click [[\\`X\\`]] to\r\n    return to the policy pipeline.\r\n\r\n18. After the Financing Web Service is invoked, you need to map the\r\n    SOAP response into a JSON object.\r\n\r\n    You already defined the response object\r\n    called [[paymentAmount]].\r\n    To do the map, click the **[financing\r\n    output]** map policy on the pipeline to\r\n    open the map editor.\r\n\r\n19. Click the [[pencil icon]] to set the output object schema.\r\n\r\n20. Click the **[+ outputs for\r\n    operation\\...]** option and select\r\n    the [[GET /calculate operation]].\r\n\r\n21. Set the [[Content type]] configuration\r\n    option\r\n    to [[application/json]],\r\n    and then\r\n    click [[Done]] to\r\n    return to the map editor.\r\n\r\n    ![](images/tutorial_html_4e9aa0f663bd6c06.png)\r\n\r\n22. Click the [[circle next to the paymentAmount source\r\n    element]] once,\r\n    then click the [[circle next to the target\r\n    element]].\r\n    A line will be drawn between the two, indicating a mapping from the\r\n    source to the target.\r\n\r\n    ![](images/tutorial_html_f2e452da44248e01.png)\r\n\r\n23. Click [[\\`X\\`]] in\r\n    the map editor to return to the policy pipeline.\r\n\r\n24. Click [[Save]] the API definition.\r\n\r\n25. Click **[Develop]** in the navigation\r\n    menu to return to the list of APIs and Products in your system.\r\n\r\n    ![](images/tutorial_html_a810481f55373ff0.png)\r\n\r\n## Import Logistics API\r\n\r\nIn this lab section, we will be adding a new API called logistics which\r\nwill provide helper services around calculating shipping rates and\r\nlocating nearby stores. Rather than require you to build the entire API\r\nfrom scratch again, you will see how you can import and modify an\r\nexisting OpenAPI definition.\r\n\r\n### Import the OpenAPI Definition\r\n\r\n1.  Click **[Add]** and\r\n    select **[API.]**  \r\n\r\n    ![](images/tutorial_html_44524c2a518bf56e.png)\r\n\r\n2.  From the Create API wizard, select [[Import: Existing\r\n    OpenAPI]].\r\n    Then\r\n    click [[Next]].  ![](images/tutorial_html_5515164592670a5f.png)\r\n\r\n3.  You will need logistics.yaml file for this step. Fron another browser window download the file using this link\r\n    [logistics.yaml](https://integrationsuperhero.github.io/techcon2020/APICDevJam/resources/logistics.yaml)\r\n\r\n    Click \\`**Browse**\\` in the [[Import from\r\n    file]] window, and select the downloaded logistics.yaml file.\r\n\r\n    ![](images/tutorial_html_2ec43e484c5482b0.png)\r\n\r\n4.  Click [[Next]] in\r\n    the confirmation window.\r\n\r\n5.  Click [[Next]] one\r\n    more time [[without selecting the option Activate\r\n    API]] since\r\n    we still need to make some updates.\r\n\r\n6.  Click [[Edit\r\n    API]] in\r\n    the [[Summary]] page\r\n    to go to the API editor.\r\n\r\n### Configure payload to be stored in Analytics\r\n\r\n1.  From the API menu, select [[Activity\r\n    Log]].\r\n    In\r\n    the [[Content]] drop-down,\r\n    select [[payload]].\r\n    A pop up window will be displayed, asking to enable buffering.\r\n    Click [[Continue]].\r\n\r\n    ![](images/tutorial_html_e8ffcd636704e49b.png)\r\n\r\n2.  Set the [[Content on\r\n    error]] drop-down\r\n    to [[activity]].\r\n    Click [[Save]].\r\n\r\n    ![](images/tutorial_html_1b4e90745e45c224.png)\r\n\r\n## Create an Orchestration Assembly\r\n\r\nThe logistics API provides resources for calculating shipping costs and\r\nlocating the nearest store for pickup. In this section, you will\r\nconfigure the assembly for the shipping calculation resource. Your API\r\nassembly will call out to two separate shipping vendors and provide a\r\nconsolidated response back to the consumer.\r\n\r\n### Create the Logistics API Assembly\r\n\r\n1.  Switch to\r\n    the [[Assemble]] tab\r\n    and remove\r\n    the [[invoke]] policy\r\n    by hovering over it and selecting the [[trashcan\r\n    icon]].\r\n\r\n2.  Click and drag\r\n    the [[Operation switch]] policy\r\n    to flow pipeline in the right.\r\n\r\n3.  The switch editor will open with a single case with case 0 created\r\n    by default.\r\n\r\n4.  Next to case 0, click **[search\r\n    operations\\...]** to show the drop-down\r\n    list of available operations.\r\n\r\n5.  Select\r\n    the **[shipping.calc]** operation.\r\n\r\n6.  Click the **[+ Case]** button to add a\r\n    second case for\r\n    the [[get.stores]] operation.\r\n\r\n7.  Click **[X]** to close the operation\r\n    switch configuration editor and then\r\n    click [[Save]].\r\n    You should see two new processing pipelines created on your\r\n    \\`operation-switch\\` step - one for each case:\r\n\r\n    ![](images/tutorial_html_2805ad613d2ba436.png)\r\n\r\n \r\n\r\n### Configure the `shipping.calc` Case\r\n\r\nThis operation will end up invoking two separate back-end services to\r\nacquire shipping rates for the respective companies, then utilize a map\r\naction to combine the two separate responses back into a single,\r\nconsolidated message for our consumers.\r\n\r\n1.  Add an [[invoke\r\n    policy]] to\r\n    the [[shipping.calc case]].\r\n\r\n2.  Edit the **[invoke]** action with the\r\n    following properties:\r\n\r\n    -   [[Title:\r\n        invoke_xyz]]\r\n\r\n    -   [[URL: $(shipping_svc_url)?company=xyz&from_zip=90210&to_zip=\\{zip\\}]]\r\n\r\n    -   [[Stop on error: unchecked]]\r\n\r\n    -   [[Response object variable (scroll to the bottom):\r\n        xyz_response]]  ![](images/tutorial_html_8c4d5816115227c1.png)  \r\n         ![](images/tutorial_html_3a71962c80162408.png)\r\n\r\n    -   **[Note: The  parameter provided here is a reference to the\r\n        zip parameter defined as input to the operation. The\r\n        portion of the URL will get replaced by the actual zip code\r\n        provided by the API consumers. ]**\r\n\r\n3.  Hover over\r\n    the [[invoke\\_xyz policy]] and\r\n    click [[clone]] to\r\n    add another invoke action:  \r\n\r\n    ![](images/tutorial_html_c099b7fb4e29d1ef.png)  \r\n\r\n4.  Edit the new invoke policy with the following properties:\r\n\r\n    -   [[Title:\r\n        invoke\\_cek]]\r\n\r\n    -   [[URL:\r\n        \\$(shipping\\_svc\\_url)?company=cek&from\\_zip=90210&to\\_zip= ]]\r\n\r\n    -   [[Response object variable:\r\n        cek\\_response]]  \r\n\r\n        ![](images/tutorial_html_84608c0a3a93f935.png)\r\n\r\n        ![](images/tutorial_html_e4fed02337332021.png)\r\n\r\n5.  Add\r\n    a [[map policy]] after\r\n    the last invoke and then click it to open the\r\n    editor.  ![](images/tutorial_html_df80d082c629e3eb.png)  \r\n\r\n6.  Click\r\n    the [[pencil]] at\r\n    the top of the Input column, then click on the [[+\r\n    input]] button.\r\n    Enter the following input configuration:\r\n\r\n    -   [[Context variable:\r\n        xyz\\_response.body]]\r\n\r\n    -   [[Name:\r\n        xyz]]\r\n\r\n    -   [[Content type:\r\n        application/json]]\r\n\r\n    -   [[Definition:\r\n        #/definitions/xyz_shipping_rsp]]\r\n\r\n7.  Click the [[+\r\n    input]] button\r\n    again to add another input. Specify the following input\r\n    configuration:\r\n\r\n    -   [[Context variable:\r\n        cek_response.body]]\r\n\r\n    -   [[Name:cek]]\r\n\r\n    -   [[Content type:\r\n        application/json]]\r\n\r\n    -   [[Definition:\r\n        #/definitions/cek_shipping_rsp]]\r\n\r\n8.  You now have two inputs assigned to the\r\n    map policy:  ![](images/tutorial_html_1cecd20554b4f15b.png)\r\n\r\n9.  Click [[Done]] to\r\n    return to the editor.\r\n\r\n10. Click the [[pencil\r\n    icon]] at\r\n    the top of\r\n    the [[Output]] column\r\n    and then click [[+ outputs for\r\n    operation\\...]] and\r\n    choose\r\n    the [[shipping.calc]] operation.\r\n\r\n11. Set **[Content\r\n    type]** to [[application/json]].\r\n\r\n12. Click [[Done]] to\r\n    return to the editor.\r\n\r\n13. Complete the mapping. To map from an input field to an output field,\r\n    click the circle next to the source element once, then click the\r\n    circle next to the target element. A line will be drawn between the\r\n    two, indicating a mapping from the source to the\r\n    target. ![](images/tutorial_html_c7529b39125204de.png)\r\n\r\n14. Click **X** to close the map editor. Your assembly policy for the\r\n    shipping.calc operation is now complete.\r\n\r\n    ![](images/tutorial_html_60e39f1d04c62b0b.png)\r\n\r\n15. Save your changes.\r\n\r\n    ![](images/tutorial_html_8eaea845d79feb97.png)\r\n\r\n## Use GatewayScript in an Assembly\r\n\r\nIn this section, you will configure the assembly for the store locator\r\nresource. You will use GatewayScript to modify the response to your\r\nconsumers, providing them a maps link to the nearest store location.\r\n\r\n### Configure the `get.stores` Case\r\n\r\nThis operation will call out to the Google Geocode API to obtain\r\nlocation information about the provided zip code, and will then utilize\r\na simple gatewayscript to modify the response and provide a formatted\r\nGoogle Maps link.\r\n\r\n1.  Add an invoke policy to\r\n    the [[get.stores case]].  ![](images/tutorial_html_8fcccda10f7fbc1e.png)\r\n\r\n2.  Edit the\r\n    new [[invoke action]] with\r\n    the following properties:\r\n\r\n    -   [[Title:\r\n        invoke\\_google\\_geolocate  ]]\r\n\r\n    -   [[URL:\r\n        https://maps.googleapis.com/maps/api/geocode/json?&address=]]\r\n\r\n    -   [[Stop on error:\r\n        unchecked ]]\r\n\r\n    -   [[Response object variable (scroll to the bottom):\r\n        google\\_geocode\\_response]]  ![](images/tutorial_html_c230669eaa51ffee.png)  \r\n          ![](images/tutorial_html_bcc946b43e8188.png)\r\n\r\n3.  Click [[X]] to\r\n    close the invoke editor.\r\n\r\n4.  Add\r\n    a [[gatewayscript policy]] with\r\n    the following properties:\r\n\r\n    -   **[Title:\r\n        gws\\_format\\_maps\\_link]**\r\n\r\n    -   Copy the following GatewayScript snippet and paste it into the\r\n        text area:\r\n\r\n```\r\n// Save the Google Geocode response body to variable\r\nvar mapsApiRsp = apim.getvariable('google_geocode_response.body');\r\n\r\n// Get location attributes from geocode response body\r\nvar location = mapsApiRsp.results[0].geometry.location;\r\n\r\n// Set up the response data object, concat the latitude and longitude\r\nvar rspObj = {\"google_maps_link\": \"https://www.google.com/maps?q=\" + location.lat + \",\" + location.lng};\r\n\r\n// Save the output     \r\napim.setvariable('message.body', rspObj)\r\n\r\n```\r\n\r\n  ![](images/tutorial_html_d005e2f600ea91f1.png)\r\n\r\n-   **[Note: Take a quick look at line 5. Notice how our gateway script\r\n    file is reading the body portion of the google\\_geocode\\_response\r\n    variable which was assigned to the output of the invoke\r\n    action.]**\r\n\r\n    Click [[X]] to\r\n    close the gatewayscript editor.\r\n\r\n    Your assembly for the \\`logistics\\` API will now include two separate\r\n    operation policies:  \r\n\r\n    ![](images/tutorial_html_3e32e5d9e2c3d543.png)\r\n\r\n7.  **Save** your\r\n    changes.  ![](images/tutorial_html_8eaea845d79feb97.png)\r\n\r\n8.  Click [[Develop]] in\r\n    the navigation menu to return to the list of APIs and Products in\r\n    your system.\r\n\r\n    ![](images/tutorial_html_a810481f55373ff0.png)\r\n\r\n## Summary\r\n\r\nCongratulations! You have successfully configured two new API's with\r\nadvanced assemblies. Throughout the tutorial, you explored the key\r\ntakeaways:\r\n\r\n-   Create a new API, including object definitions and paths.\r\n\r\n-   Configure an API to access an existing SOAP service.\r\n\r\n-   Import an existing API from an OpenAPI definition document (a.k.a\r\n    Swagger).\r\n\r\n-   Map data retrieved from multiple API calls into an aggregate\r\n    response.\r\n\r\n-   Use GatewayScript directly within an API assembly.\r\n\r\nContinue with the APIC Dev Jam! Go\r\nto [APIC Dev Jam - Lab 6 - Working with API Products](../Lab6))] to\r\nlearn about bundling the API's into a Product and publishing it to the consumer portal.\r\n","fileAbsolutePath":"C:/Users/ruffa/Documents/GitHub/cp4i-demohub/src/pages/APICDevJam/Lab5/index.md"}}},"staticQueryHashes":["1054721580","1054721580","1364590287","2102389209","2102389209","2456312558","2746626797","2746626797","3018647132","3018647132","3037994772","3037994772","768070550","768070550"]}